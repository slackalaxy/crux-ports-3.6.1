# Description: AdoptOpen JDK distribution
# URL: https://github.com/AdoptOpenJDK
# Maintainer: Petar Petrov, slackalaxy at gmail dot com
# Depends on: alsa-lib freetype xorg-libxrender xorg-libxtst

name=adoptopenjdk
version=11.0.11_9
release=1
source=(https://github.com/AdoptOpenJDK/openjdk11-binaries/releases/download/jdk-11.0.11%2B9/OpenJDK11U-jdk_x64_linux_hotspot_${version}.tar.gz
	$name.revdep)

build() {
	cd jdk-11.0.11+9
	
	# cleanup
	rm -rf man/{ja,ja_JP.UTF-8}

	# create installation folders
	mkdir -p $PKG/usr/{bin,lib/jdk/openjdk8,lib/jdk/openjdk16-jdk,share/man}
	mv man $PKG/usr/share/
	mv *   $PKG/usr/lib/jdk/

	cd $PKG/usr/lib
	ln -s jdk java

	cd $PKG/usr/bin
 	ln -s ../lib/jdk/bin/java    java
 	ln -s ../lib/jdk/bin/javac   javac
 	ln -s ../lib/jdk/bin/javap   javap
 	ln -s ../lib/jdk/bin/jar     jar
 	ln -s ../lib/jdk/bin/keytool keytool
	
	# trick some packages that we have openjdk8
	cd $PKG/usr/lib/jdk/openjdk8
	ln -s ../bin bin
	ln -s ../conf conf
	ln -s ../include include
	ln -s ../jmods jmods
	ln -s ../lib lib
	
	# trick some packages that we have openjdk16-jdk
	cd $PKG/usr/lib/jdk/openjdk16-jdk
	ln -s ../bin bin
	ln -s ../conf conf
	ln -s ../include include
	ln -s ../jmods jmods
	ln -s ../lib lib
	
	mkdir -p $PKG/etc/ld.so.conf.d
	echo "/usr/lib/jdk/lib" >> $PKG/etc/ld.so.conf.d/$name.conf
	echo "/usr/lib/jdk/lib/server" >> $PKG/etc/ld.so.conf.d/$name.conf
	echo "/usr/lib/jdk/lib/jli" >> $PKG/etc/ld.so.conf.d/$name.conf
	
	# revdep
	mkdir -p $PKG/etc/revdep.d
	cat $SRC/$name.revdep > $PKG/etc/revdep.d/$name
}
