# Description: Lightweight video thumbnailer that can be used by file managers.
# URL: https://github.com/dirkvdb/ffmpegthumbnailer
# Maintainer: Petar Petrov, slackalaxy at gmail dot com
# Depends on: brotli ffmpeg4 gnutls graphite2 lame libass libtheora libva libvdpau libvpx libwebp opus x264 x265

name=ffmpegthumbnailer
version=2.2.2
release=3
source=(https://github.com/dirkvdb/$name/archive/$version.tar.gz
	efb5b618.patch
	ffmpegthumbnailer-ffmpeg5.patch)

build() {

	# Taken from Arch
	#patch -d $name-$version -p1 < $SRC/ffmpegthumbnailer-ffmpeg5.patch # Fix build with FFmpeg 5
	#patch -d $name-$version -p1 < $SRC/efb5b618.patch # Fix build with FFmpeg 5
	
	export PKG_CONFIG_PATH="/usr/lib/ffmpeg4/pkgconfig/:$PKG_CONFIG_PATH"
	
	cd $name-$version
	mkdir -p build
	cd build
	cmake \
	-D CMAKE_C_FLAGS:STRING="$CFLAGS -I/usr/include/ffmpeg4/" \
	-D CMAKE_CXX_FLAGS:STRING="$CXXCFLAGS -I/usr/include/ffmpeg4/" \
	-D CMAKE_BUILD_TYPE=Release \
	-D CMAKE_INSTALL_PREFIX=/usr \
	-D CMAKE_INSTALL_LIBDIR=lib \
	-D ENABLE_GIO=ON \
	-D ENABLE_THUMBNAILER=ON ..

	make
	make DESTDIR=$PKG install
}
