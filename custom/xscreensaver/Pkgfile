# Description: A screen saver and locker daemon for xorg patched to work with electricsheep
# URL: https://www.jwz.org/xscreensaver/
# Maintainer: Petar Petrov, slackalaxy at gmail dot com
# Depends on: bc fortune gdk-pixbuf-xlib giflib glu intltool libglade linux-pam xorg-libxmu xorg-libxi electricsheep

name=xscreensaver
version=6.02
release=1
source=(https://www.jwz.org/$name/$name-$version.tar.gz
	$name.pam 01_electricsheep.patch 02_rss.patch)

build() {
	cd $name-$version

	patch -p1 -i $SRC/01_electricsheep.patch
	#patch -p1 -i $SRC/02_rss.patch

	./configure \
		--prefix=/usr \
		--libexecdir=/usr/lib \
		--with-x-app-defaults='/etc/X11/app-defaults' \
		--enable-locking \
		--enable-root-passwd \
		--disable-nls \
		--with-dpms-ext \
		--with-xinerama-ext \
		--with-xshm-ext \
		--with-proc-interrupts \
		--with-shadow \
		--with-pixbuf \
		--with-jpeg \
		--without-motif \
		--without-gle \
		--without-setuid-hacks

	make
	make install_prefix=$PKG install
	chmod 755 $PKG/usr/bin/xscreensaver
	install -d $PKG/usr/share/wallpapers

	echo "NotShowIn=KDE;GNOME;" >> $PKG/usr/share/applications/xscreensaver-properties.desktop

	# PAM service file
	install -D -m 0644 $SRC/$name.pam $PKG/etc/pam.d/$name

	rm -r $PKG/usr/share/{locale,xscreensaver/config/README}
}
